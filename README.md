# Numenta Company Website

> http://numenta.com

Source code, generators, tooling, and content for Numenta company website.
This company website is focused on our business and strategy, and is sibling to
Numenta's educational and HTM [Community](http://numenta.org) website.


## Goals

This site is an attempt to get back to the roots of a web page: *reading*.
[Inspired by](http://numenta.com/blog/2016/09/02/why-did-we-completely-change-our-website-design-the-story-behind-our-new-look/)
the classic design of [Wikipedia](https://en.wikipedia.org/wiki/Numenta), we
hope this site will be easy to read, helpful for finding information quickly,
simple to navigate, and a delight for users to interact with.

Moving from a full statically-generated multi-page website, to a single one-page
web application, is a tricky proposition. Search engine ranking can be affected,
as important internal pages and links would disappear. Navigating the user to
one of many collapsable sections on a long page can be difficult. Accessible,
legacy, and unique browsers cannot usually support the modern technology
required for single-page web applications.

To solve these challenges, while still accomplishing our goals, we have built
this as a **hybrid** website architecture. It is **both** a classic
statically-generated multi-page website, and also a modern single-page web
application. All clients load the classic static site initially, and then modern
clients will be augmented with the single-page app. This is accomplished with
the magic of ["universal" or "isomorphic" javascript](http://isomorphic.net/):
the exact same code is used to generate the static site on the server, and then
is loaded on the client to continue the app live.


## Environments

### Server

* Script
  * ECMAscript [ES6](https://github.com/lukehoban/es6features) (Javascript)
    * [Node.js 6](https://nodejs.org) + [Npm 3](https://www.npmjs.com/)
    * [Babel](https://babeljs.io/) Transpiler down to older cross-browser JS
    * Babel [ESLint](http://eslint.org/) code style checking ("linting")
  * [Gatsby](https://github.com/gatsbyjs/gatsby) static site generator, wrapping:
    * [Webpack](https://webpack.github.io/) module loader/bundler, and
      [Static Generator Plugin](https://github.com/markdalgleish/static-site-generator-webpack-plugin)
    * [React.js](https://facebook.github.io/react/) reactive view components in
      [JSX](https://facebook.github.io/react/docs/jsx-in-depth.html) format
    * [Lunr](http://lunrjs.com/) client-side fulltext site search
    * Instrumented with [Google Analtyics](https://www.google.com/analytics/)
      and [Pingdom](https://www.pingdom.com/)
* Style
  * [Tachyons](http://tachyons.io/) Responsive style library, composed via
    [CSS Modules](https://github.com/css-modules/css-modules)
  * Format checking by [stylelint](https://github.com/stylelint/stylelint)
* Markup
  * [HTML5](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5) spec
  * Style linting by [htmllint](https://github.com/htmllint/htmllint-cli)
* Assets
  * [React Icon Library](http://gorangajic.github.io/react-icons/)
  * Images: Prefer [SVG](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics),
    and [PNG](https://en.wikipedia.org/wiki/Portable_Network_Graphics)
  * Icons autogenerated by
    [Favicons](https://github.com/jantimon/favicons-webpack-plugin)
    webpack plugin

### Clients

#### Baseline

All browsers and clients will start by loading a classic, simple,
statically-generated, multi-page site. This guarantees that all users will
receive a decent baseline experience, especially on older, accessible, or unique
browsers. This also gives robots and search engine crawlers to have many
internal pages to link and index.

#### Advanced

After loading the baseline experience, modern clients (listed in the support
table below) will then be augmented with an advanced single-page style web
application. This lets us simulate a large single main page, with many
collapsable sections, much like Wikipedia. This also provides fast "no-refresh"
page transitions, a full client-side text search system, etc.

|             | Chrome | Firefox | Safari | Edge | IE/11 | IE/10 | Android |
| ----------- |:------:|:-------:|:------:|:----:|:-----:|:-----:|:-------:|
| **Mac/OSX** |    ✓   |    ✓    |    ✓   |      |       |       |         |
| **iOS**     |        |         |    ✓   |      |       |       |         |
| **Android** |    ✓   |         |        |      |       |       |    ✓    |
| **Win/10**  |    ✓   |    ✓    |        |   ✓  |       |       |         |
| **Win/8**   |        |         |        |      |   ✓   |       |         |
| **Win/7**   |        |         |        |      |       |   ✓   |         |
| **Linux**   |    ✓   |    ✓    |        |      |       |       | &nbsp;  |

**Note:** *All versions are "Latest Stable" unless otherwise noted.*


## Filesystem

```shell
.                       # https://github.com/numenta/numenta-web/numenta.com/
├── .babelrc            # Babel ES6 transpiler configuration file
├── .eslintrc.json      # ES lint rules, mostly AirBnB defaults + few tweaks
├── .stylelintrc        # CSS style lint rules
├── LICENSE.txt         # AGPLv3, more at: http://numenta.org/licenses/
├── README.md           # This file, welcome docs.
├── components/         # React.js View Components and UI modules (HTML/CSS/JS)
├── config.toml         # Configuration setings for Gatsby static site generator
├── gatsby-browser.js   # Browser-specific code, tied to React Router by Gatsby
├── gatsby-node.js      # Build-time, Node.js, Webpack & Server specific code
├── html.jsx            # Main HTML Document Component
├── node_modules/       # `npm` module install target (not in git)
├── package.json        # Project scripts, settings, and `npm` dependency lists
├── pages/              # Webpage Documents and URL Tree Structure
├── public/             # STATIC OUTPUT. Static website generated built files
├── static/             # Static html, styles, assets, etc. Copied after build.
├── utils/              # Local Helpers, utils, client, and misc code
└── wrappers/           # Document-type (.html, .md, etc.) wrapper Components
```


## Setup

These instructions assume latest Mac OS/X with [homebrew](http://brew.sh/)
package manager installed. Other platforms should come up just as easily.

```shell
brew install git node
git clone git@github.com:numenta/numenta-web.git
cd numenta-web/numenta.com
npm install
```


## Build

Unless otherwise stated below, the `config.toml` file should have the default
empty `linkPrefix` setting:

```shell
# config.toml
linkPrefix = ""
```

### Development

#### Dynamic

```shell
npm run dev
# Visit http://localhost:8000
```

Static assets won't load correctly from `static/assets` during dynamic dev, but
they will be fine later on staging and production after static build. Try the
static dev (next section below) if you need the static asset links to work
during development.

If you need to host via a specific local IP (testing on a VM, etc.), `gatsby`
options can be passed to `npm run` like this:

```shell
npm run dev -- --host 192.168.1.112 --port 8765
# Visit http://192.168.1.112:8765
```

To get search working under local dynamic development mode, you first need to
build the search index, and then copy the index over to where it will be
accessible by the dev webserver:

```shell
npm run build
cp public/_searchIndex.json pages/.
```

#### Static

```shell
npm run serve
# Visit http://localhost:8000
```

### Integration

Update Gatsby config for GitHub Pages (gh-pages) integration targets. Modify
`config.toml` and set (but DO NOT commit):

```shell
# config.toml
linkPrefix = "/numenta-web"
```

And then run an integration build:

```shell
npm run build
```

#### Personal

Push build to personal fork `origin:gh-pages` integration hosting branch:

(Note: This will remove any other gh-pages site staged on that branch).

```shell
npm run deploy:gh-pages
npm run deploy:gh-pages -- --remote origin  # same thing
# Visit http://fork.github.io/numenta-web/
```

#### Shared

Push build to shared `upstream:gh-pages` integration hosting branch:

(Note: This will remove any other gh-pages site staged on that branch).

```shell
# Deploy master branch public/ to upstream:gh-pages branch
npm run deploy:gh-pages -- --remote upstream

# Visit http://numenta.github.io/numenta-web/
```

### Staging

```shell
npm run build
# Push output to `master` branch of `NumentaCorp/numenta.com:out/` repo-path.
# Wait a few minutes for build to happen. THIS WILL CHANGE SOON.
# Visit https://staging.numenta.com
```

### Production

```shell
npm run build
# Push output to `production` branch of `NumentaCorp/numenta.com:out/` repopath.
# Wait a few minutes for build to happen. THIS WILL CHANGE SOON.
# Visit https://numenta.com
```


## Scripts

| Function | `<command>` | Notes |
| -------- | ----------- | ----- |
| Build | `npm run build` | Generate static production files |
| Clean | `npm run clean` | Clean build |
| Deploy | `npm run deploy:gh-pages` | Deploy branch `public/` build to `origin:gh-pages` |
| Develop | `npm run dev` | Develop site interactively on http://localhost:8000 |
| Lint | `npm run lint` | Check code for meeting js/css/html linting conventions |
| Serve | `npm run serve` | Builds, then Serves static output |


## Standards

Code standards are handled by their respective linters and lint configs.

### Components

* Each `React` Component should return 1 small element
* Include spaces manually around React Elements in JSX with: `{' '}`
* `config` is available in components via
  [context](https://facebook.github.io/react/docs/context.html)
* Make sure to use the `prefixLink()` helper function on all internal links

### Content

* Markdown link target filenames with spaces must be quoted:
  `[link text]("spaces in filename.txt")`
* Markdown YAML headmatter: be careful with quotes and escaping titles, etc.
* Beware extra Markdown
  [typographer shortcuts](https://github.com/jonschlinkert/remarkable#typographer)
* Internal flat markdown auto-links (`http://numenta.com/htm-studio/`) may break
  on staging servers, use markdown style instead:
  `[http://numenta.com/htm-studio/](/htm-studio/)`

### Packages

* Bump version number with each changeset: `npm version patch`
* Keep packages as up-to-date as possible. Check with: `npm outdated -depth 0`
* Update and test 1 package at a time

### Styles

* `CSS Module` Composition order:

  1. Compose from Tachyons classes
  1. Compose from Site Theme classes (Numenta colors)
  1. Compose from \_local_file_custom classes
  1. Specific custom CSS overrides

  Example:
  ```css
  ._visited:visited {
    color: #1aa0db;
  }

  .iconlink {
    composes: dim from 'tachyons';
    composes: link from 'tachyons';
    composes: color-blue from '../../assets/css/theme.css';
    composes: _visited;
    opacity: 0.5;
  }
  ```


## Link Types

| Host     | Type              | .jsx Source    | .md Source     |
| -------- | ----------------- | -------------- | -------------- |
| Internal | Path              | [View][link1]  | [View][link7]  |
| Internal | Anchor            | [View][link2]  | [View][link8]  |
| Internal | Asset (/assets/*) | [View][link3]  | [View][link9]  |
| Internal | Asset (*/.pdf)    | N/A            | [View][link13] |
| External | Path              | [View][link4]  | [View][link10] |
| External | Anchor            | [View][link5]  | [View][link11] |
| External | Protocol          | [View][link6]  | [View][link12] |

[link1]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/open-source-community/_Section.jsx#L58
[link2]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L178
[link3]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L248
[link4]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L207
[link5]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/applications/_Section.jsx#L213
[link6]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/partners/_Section.jsx#L48
[link7]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/02/11/numenta-anomaly-benchmark-contest-ieee-wcci-2016.md
[link8]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/06/16/can-neuroscientists-understand-the-brain.md
[link9]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2014/08/18/progress-at-numenta.md
[link10]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2014/09/17/increasing-research-transparency.md
[link11]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2013/02/11/super-bowl-neuroscience.md
[link12]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/02/11/numenta-anomaly-benchmark-contest-ieee-wcci-2016.md#numenta-anomaly-benchmark-nab-competition
[link13]: https://github.com/numenta/numenta-web/blob/master/numenta.com/pages/blog/2016/03/30/numenta-at-computational-and-systems-neuroscience-conference.md

**Note:** *Make sure Google Analtyics is tracking `pages` and `events` for all
  the above.*


## @TODO

* SHOW search after index loads, X clear button? no server-side search actually allowed!
* document the code, build docs
* put copyright notice at top of source files
* markdown content image no hover effect
* special custom npm modules: tachyons,etc. - howto, updating, etc.
